<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Burger Shot - Staff Meals</title>

  <!-- Bootstrap CSS CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&display=swap" rel="stylesheet" />

  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #fff4d6;
      margin: 0;
      display: flex;
      min-height: 100vh;
      color: #333;
    }
    .sidebar {
      background-color: #c82333;
      width: 220px;
      color: white;
      padding: 2rem 1.5rem;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    .sidebar h2 {
      font-weight: 700;
      font-size: 1.8rem;
      margin-bottom: 2rem;
      text-align: center;
      user-select: none;
    }
    .sidebar a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      padding: 0.75rem 0.5rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.3s;
      user-select: none;
    }
    .sidebar a:hover, .sidebar a.active {
      background-color: #a71d2a;
      text-decoration: none;
    }

    main {
      flex-grow: 1;
      padding: 2rem 3rem;
      background-color: #fff4d6;
      overflow-y: auto;
    }

    h1 {
      color: #c82333;
      font-weight: 700;
      margin-bottom: 2rem;
      user-select: none;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    label {
      font-weight: 700;
      user-select: none;
      display: block;
      margin-bottom: 0.3rem;
    }

    select {
      width: 100%;
      padding: 0.5rem;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      user-select: text;
      appearance: none;
      background: white url("data:image/svg+xml,%3Csvg fill='none' stroke='%23333' stroke-width='2' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M6 9l6 6 6-6'/%3E%3C/svg%3E") no-repeat right 10px center;
      background-size: 1em;
      cursor: pointer;
      outline: none;
    }

    button {
      background-color: #c82333;
      border: none;
      color: white;
      font-weight: 700;
      padding: 0.7rem 1.5rem;
      border-radius: 8px;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
      margin-top: 1rem;
      display: inline-block;
    }
    button:hover {
      background-color: #a71d2a;
    }

    #notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #c82333;
      color: white;
      padding: 15px 25px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      font-weight: 700;
      font-family: 'Montserrat', sans-serif;
      display: none;
      z-index: 1000;
      max-width: 90vw;
      text-align: center;
      white-space: nowrap;
    }

    /* Hamburger button */
.hamburger {
  display: none;
  font-size: 2rem;
  background: none;
  border: none;
  cursor: pointer;
  color: #c82333; /* Burger Shot red */
  margin: 1rem;
  z-index: 2000;
  position: fixed;
  top: 10px;
  left: 10px;
}

/* Sidebar adjustments for mobile */
@media (max-width: 768px) {
  .hamburger {
    display: block; /* show hamburger on small screens */
  }

  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 220px;
    background-color: #c82333;
    transform: translateX(-100%); /* hidden */
    transition: transform 0.3s ease;
    z-index: 1500;
  }

  .sidebar.active {
    transform: translateX(0); /* slide in */
  }

  /* Make sure main content isn‚Äôt squeezed */
  .main-container {
    flex-direction: column;
  }
  main {
    padding: 1rem;
    margin-left: 0;
  }
}
  </style>
</head>
<body>
  <button id="menuToggle" class="hamburger">‚ò∞</button>
  <div class="main-container" style="display:flex; width:100%; min-height:100vh;">
  <aside class="sidebar">
    <h2>üçî Burger Shot</h2>
    <nav>
      <ul class="list-unstyled">
        <li><a href="home.html">üè† Home</a></li>
        <li><a href="register.html">üñãÔ∏è Register</a></li>
        <li><a href="orders.html">üìã Orders</a></li>
        <li><a href="inventory.html">üì¶ Inventory</a></li>
        <li><a href="market.html">üè™ Market Run</a></li>
        <li><a href="staffmeals.html" class="active">üçΩÔ∏è Staff Meals</a></li>
        <li><a href="loyalty.html">üéÅ Customers</a></li>
      </ul>
    </nav>
  </aside>

  <main>
    <h1>üçΩÔ∏è Staff Meals</h1>

      <p style="font-weight:600; color:#c82333; margin-top:-1rem; margin-bottom:1.5rem;">
    Employees are entitled to 5 drinks and 5 food items per shift. Please make sure you log it here so that the inventory stays accurate.
  </p>

    <div class="form-group">
      <label for="employeeSelect">Select Employee</label>
      <select id="employeeSelect" required>
        <option value="" disabled selected>Select your name</option>
        <option value="Savannah">Savannah</option>
        <option value="Munch">Munch</option>
        <option value="Slade">Slade</option>
        <option value="Jack">Jack</option>
        <option value="Tyrod">Tyrod</option>
      </select>
    </div>

    <div class="form-group">
      <label for="foodSelect">Select Food Item</label>
      <select id="foodSelect" aria-label="Food item selection">
        <option value="">-- None --</option>
        <option value="Burgershot Bleeder">Burgershot Bleeder</option>
        <option value="The Double Shot">The Double Shot</option>
        <option value="Fries">Fries</option>
        <option value="Rim Job">Rim Job</option>
        <option value="Cream Pie">Cream Pie</option>
      </select>
      <label for="foodQty">Quantity (max 5)</label>
      <select id="foodQty" aria-label="Food quantity">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>

    <div class="form-group">
      <label for="drinkSelect">Select Drink Item</label>
      <select id="drinkSelect" aria-label="Drink item selection">
        <option value="">-- None --</option>
        <option value="Burgershot Soda">Burgershot Soda</option>
      </select>
      <label for="drinkQty">Quantity (max 5)</label>
      <select id="drinkQty" aria-label="Drink quantity">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select>
    </div>

    <button id="submitMeal">Submit Staff Meal</button>
  </main>

  <div id="notification"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      updateDoc,
      collection,
      addDoc
    } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBgsHAYXZeLIv-vC0LCHbNHjOTrZOq3GBA",
      authDomain: "burgershotorders.firebaseapp.com",
      projectId: "burgershotorders",
      storageBucket: "burgershotorders.appspot.com",
      messagingSenderId: "244133569976",
      appId: "1:244133569976:web:0dcca3439958188439db4d",
      measurementId: "G-2X69N31D9Q"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const inventoryDocRef = doc(db, "inventory", "current");
    const staffMealsCollection = collection(db, "staff_meals");

    // ‚úÖ Same ingredients map as register.html
    const productIngredients = {
      "Burgershot Bleeder": { burger_buns: 1, ground_beef: 1, cheese_slices: 2 },
      "The Double Shot": { burger_buns: 1, ground_beef: 1, lettuce: 1 },
      "Burgershot Soda": { corn_syrup: 1 },
      "Fries": { potato: 2 },
      "Rim Job": { sugar: 1, flour: 1 },
      "Cream Pie": { sugar: 1, flour: 1 }
    };

    function showNotification(message, duration = 4000) {
      const n = document.getElementById('notification');
      n.textContent = message;
      n.style.display = 'block';
      n.style.opacity = '1';

      if (showNotification.timeoutId) clearTimeout(showNotification.timeoutId);

      showNotification.timeoutId = setTimeout(() => {
        n.style.transition = 'opacity 0.5s ease';
        n.style.opacity = '0';
        n.addEventListener('transitionend', () => {
          n.style.display = 'none';
          n.style.transition = '';
        }, { once: true });
      }, duration);
    }

    async function submitStaffMeal() {
      const employee = document.getElementById('employeeSelect').value;
      const foodItem = document.getElementById('foodSelect').value;
      const foodQty = parseInt(document.getElementById('foodQty').value) || 0;
      const drinkItem = document.getElementById('drinkSelect').value;
      const drinkQty = parseInt(document.getElementById('drinkQty').value) || 0;

      if (!employee) {
        showNotification("Please select your name.");
        return;
      }

      const items = [];
      if (foodItem && foodQty > 0) items.push({ name: foodItem, quantity: foodQty });
      if (drinkItem && drinkQty > 0) items.push({ name: drinkItem, quantity: drinkQty });

      if (items.length === 0) {
        showNotification("Please select at least one food or drink with quantity.");
        return;
      }

      const docSnap = await getDoc(inventoryDocRef);
      if (!docSnap.exists()) {
        showNotification("No inventory found!");
        return;
      }
      const inventory = docSnap.data();
      const totalNeeded = {};

      // build required ingredients
      items.forEach(item => {
        const needed = productIngredients[item.name];
        if (needed) {
          for (const ing in needed) {
            totalNeeded[ing] = (totalNeeded[ing] || 0) + needed[ing] * item.quantity;
          }
        }
      });

      // check shortages
      const missing = [];
      for (const ing in totalNeeded) {
        if ((inventory[ing] || 0) < totalNeeded[ing]) {
          missing.push(`${ing} (need ${totalNeeded[ing]}, have ${inventory[ing] || 0})`);
        }
      }
      if (missing.length > 0) {
        showNotification("Not enough ingredients: " + missing.join(", "));
        return;
      }

      // deduct inventory
      for (const ing in totalNeeded) {
        inventory[ing] -= totalNeeded[ing];
      }
      await updateDoc(inventoryDocRef, inventory);

      // log staff meal
      await addDoc(staffMealsCollection, {
        employee,
        items,
        timestamp: new Date()
      });

      showNotification("‚úÖ Staff meal recorded and inventory updated!");

      // reset
      document.getElementById('employeeSelect').value = "";
      document.getElementById('foodSelect').value = "";
      document.getElementById('foodQty').value = "0";
      document.getElementById('drinkSelect').value = "";
      document.getElementById('drinkQty').value = "0";
    }

    document.getElementById('submitMeal').addEventListener('click', submitStaffMeal);
  </script>
<script>
  const menuBtn = document.getElementById("menuToggle");
  const sidebar = document.querySelector(".sidebar");

  menuBtn.addEventListener("click", () => {
    sidebar.classList.toggle("active");
  });
</script>  

</body>
</html>
